---
title: "Metodolog√≠as avanzadas de aprendizaje autom√°tico para la gesti√≥n en las organizaciones"
subtitle: "Segunda Evaluaci√≥n"
author: "Rafael Zambrano"
institute: "Universidad de Buenos Aires, Facultad de Ciencias Economicas, ENAP"
date: "2021/06/29"
output:
  xaringan::moon_reader:
    seal: false
    css: xaringan-themer.css
    nature:
      countIncrementalSlides: false
      navigation: 
        scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, 
                      message = FALSE, 
                      comment=FALSE)
```

```{r ,echo=FALSE}
library(tidyverse)
library(lubridate)
```


class: center

```{r xaringan-themer, include=FALSE, warning=FALSE, eval=FALSE}
library(xaringanthemer)
#style_mono_light(base_color = "#23395b")
#style_duo_accent(primary_color = "#FFFFFF", secondary_color = "#FA795E")
style_duo_accent(primary_color = "#FA795E",
                 secondary_color = "#FFFFFF",
                 header_h1_font_size = "1.8rem",
                 header_h2_font_size = "1.5rem",
                 header_h3_font_size = "1.0rem"
                 )
#style_duo_accent_inverse(primary_color = "#FFFFFF", secondary_color = "#FA795E")
#style_duo_accent_inverse(primary_color = "#FA795E", secondary_color = "#FFFFFF")
```


```{r, echo=FALSE}
knitr::include_graphics('fondo_fce.png')
```

<br>
<br>
<br>
<br>

```{r, echo=FALSE}
knitr::include_graphics('titulo.png') 
```

<br>
<br>

#### 2021-06-29
---
class: center

```{r, echo=FALSE}
knitr::include_graphics('fondo_fce.png')
```

<br>
<br>
<br>

# Asignatura: Metodolog√≠as avanzadas de aprendizaje autom√°tico para la gesti√≥n en las organizaciones

<br>

## Segunda Evaluaci√≥n

#### Rafael Zambrano

---

# Ocurrencia de delitos

üî∏ La ocurrencia de delitos es un fenomeno de √≠ndole social y econ√≥mico, dado lo amplio y transversal que resulta estudiar este t√≥pico, se aborda el tema mediante una relaci√≥n funcional entre la problem√°tica y **la dualidad ‚Äúentorno-tiempo‚Äù**. 

<br>
<br>

---
# Campos de aplicaci√≥n actual

üî∏ Computer vision

```{r, echo=FALSE, out.width='40%',out.height='40%',fig.align='center'}
knitr::include_graphics('vision.png')
```

---
# Campos de aplicaci√≥n actual

üî∏ Sound / Text Analysis

```{r, echo=FALSE, out.width='70%',out.height='70%',fig.align='center'}
knitr::include_graphics('sound.png')
```

---
# Campos de aplicaci√≥n actual

üî∏ Temporal-Geographic analysis

* [Predictable Policing: Measuring the Crime Control Benefits of Hotspots Policing at Bus Stops](https://link.springer.com/article/10.1007/s10940-016-9312-y)

* [Prediction of Suspect Location Based on Spatiotemporal Semantics](https://www.mdpi.com/2220-9964/6/7/185/htm)

* [Grid-Based Crime Prediction Using Geographical Features](https://www.mdpi.com/2220-9964/7/8/298/htm)

---
# Resumen

üî∏ En la ciudad de Taoyuan (Taiw√°n), se realiz√≥ un estudio de predicci√≥n de delitos basado en cuadr√≠culas, comparando el rendimiento de **modelos de aprendizaje autom√°tico con un modelo de aprendizaje profundo**. 

üî∏ Se aplic√≥ un esquema de modelado basado en cuadr√≠culas geogr√°ficas, este permiti√≥  establecer una gama de caracter√≠sticas espacio-temporales basadas en 84 variables.

üî∏ Fueron seleccionados los delitos del tipo **‚Äúrobo de veh√≠culo‚Äù**, para el periodo enero - 2015 / abril - 2018, realizando predicciones para el periodo enero - 2017 / abril - 2018.

üî∏ Se estableci√≥ una l√≠nea base, que consisti√≥ en una media m√≥vil de los √∫ltimos 11 meses para predecir el mes n√∫mero 12. Fueron implementados modelos de aprendizaje autom√°tico como Random Decision Forest, Support Vector Machine y K-Near Neighbor, adem√°s, se implement√≥ un modelo DNN.

üî∏ El modelo de DNN result√≥ ser el que obtuvo un mejor rendimiento, en funci√≥n de la m√©trica F1, mostrando una mejora de aproximadamente el 7% sobre el modelo base.

---

# Problem√°tica

üî∏ Taoyuan es una de las ciudades m√°s grandes de Taiw√°n con una poblaci√≥n de 2,1 millones para 2018.  Entre 2015 a 2016 se registr√≥ un promedio anual de alrededor de 20.000 delitos.

üî∏ Seg√∫n el √çndice de delitos [NUMBEO](https://www.numbeo.com/crime/in/Taoyuan) de 2018, el puntaje de delitos de Taoyuan fue de 27,5 , que es m√°s alto que el promedio en Taiw√°n ( 20.74).

---

# Problem√°tica
 
## Enfoque tradicional
 
* Modelos espacio-temporales
 
üî∏ Estos m√©todos incluyen la estimaci√≥n de densidad de kernel (KDE) y modelos de series temporales. Sin embargo, estos dos m√©todos solo consideran el tiempo o el espacio de forma independiente, pero el crimen se ve afectado por m√°s de un factor.
 
--
 
üî∏ Cuando este enfoque se aplica en base a cuadr√≠culas espaciales, s√≥lo se examinan factores como el tiempo, el espacio y el tipo de delito, pero rara vez se discuten las caracter√≠sticas geogr√°ficas de la cuadr√≠cula.
 
---

# Transformaci√≥n y limpieza de datos
 
* **Fuente de datos**
 
üî∏ Este estudio integra aspectos experienciales con caracter√≠sticas geogr√°ficas adicionales para simular el entorno delictivo y permitir modelos de predicci√≥n de delitos basados.
 
üî∏ Los delitos registrados se extrajeron de un repositorio de datos abiertos del gobierno de Taiw√°n. [Link Repostiorio](https://data.gov.tw).   
 
üî∏ Se extraen y generan caracter√≠sticas espacio-temporales basadas en 84 tipos de informaci√≥n geogr√°fica mediante la API de Google Places, estos datos se enlazan con el registro de delitos de la ciudad.

--

```{r, echo=FALSE, out.width='60%',out.height='40%', fig.align='center'}
knitr::include_graphics('googleplaces.png')
```

---

# Transformaci√≥n y limpieza de datos
 
## EDA
 
* Incidencia hist√≥rica de delitos

```{r, echo=FALSE, out.width='70%',out.height='40%', fig.align='center'}
knitr::include_graphics('eda.png')
```

---
# Transformaci√≥n y limpieza de datos
 
## Creaci√≥n de cuadr√≠culas espaciales

```{r, echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('grid_esquema.png')
```

üî∏ Se calcula el n√∫mero de delitos ocurridos dentro de cada cuadr√≠cula para cada uno de los meses de estudio.

---
# Transformaci√≥n y limpieza de datos
 
## Esquema de partici√≥n de datos

<br>

```{r, echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('time_esquema.png')
```

---
# Transformaci√≥n y limpieza de datos
 
## Creaci√≥n de variables delictivas
 
üî∏ Temporales:
 
* C√°lculo acumulativo de delitos en ventanas de tiempo (condici√≥n demogr√°fica).
* C√°lculo de delitos ocurridos en el mismo mes del a√±o anterior (patr√≥n estacional).
 
üî∏ Espaciales:
 
* Caracter√≠sticas de la cuadr√≠cula (simulaci√≥n de escenas delictivas).
* Cuadr√≠culas adyacentes (desplazamiento del delito).

---

# Transformaci√≥n y limpieza de datos
 
## Creaci√≥n de variables delictivas

```{r, echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('cracateristicas_esquema.png')
```

---

# Modelo Base

<br>

üî∏ Medias m√≥viles

```{r, echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('ma.png')
```

---

# Modelos de Aprendizaje autom√°tico

üî∏ K-Nemost Neighbor (KNN)

üî∏ Support Vector Machine (SVM) 

üî∏ Random Decision Forest (RF )

* Ejemplo del ajuste del modelo KNN

```{r, echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('ml.png')
```

---

# Modelo de Aprendizaje Profundo
 
üî∏ Se utiliz√≥ un modelo de DNN de capas ocultas profundas con un mecanismo de dropout con las siguientes caracter√≠sticas:
 
* 9 capas con 100 neuronas cada una.
* Dropout de 0.2 para todas las capas
* Se us√≥ ReLu como funci√≥n de activaci√≥n, present√≥ un mejor rendimiento que la funci√≥n sigmoide.
* 45 √©pocas.
* Tasa de aprendizaje de 0.001
* Se utiliz√≥ el framework de deep learning de h2o.

---

# Modelo de Aprendisaje Profundo

* Estructura del modelo DNN

```{r ,eval=FALSE}
 model_dp =  h2o.deeplearning(x = dataX,
                              y = dataY,
                              training_frame = dtrain,
                              hidden = c(100,100,100,100,100,100,100,100,100),
                              activation = "RectifierWithDropout",
                              input_dropout_ratio = 0.2,
                              hidden_dropout_ratios = rep(0.2,9),
                              rate = 0.001,
                              epochs = 45)
```

---

# Comparaci√≥n de modelos

<br>

```{r, echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('comparacion_plot.png')
```

---

# Comparaci√≥n de modelos

üî∏ Se utiliz√≥ una prueba t para determinar si la diferencia de rendimiento entre estos m√©todos era estad√≠sticamente significativa

<br>

```{r, echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('comparacion_table.png')
```

---

# Rendimiento del modelo DNN para cada partici√≥n.

<br>

```{r, echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('dnn_table.png')
```

---
# Rendimiento promedio del modelo DNN para distintas m√©tricas.

<br>

```{r, echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('dnn_metricas.png')
```

---

# Importancia de variables

üî∏ Se ejecutan las predicciones agregando dos escenarios, excluyendo las variables geogr√°ficas y dejando √∫nicamente las variables geogr√°ficas.

<br>

```{r, echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('iv_1.png')
```

---

# Importancia de variables

üî∏ Calculando la suma acumulada de las 10 caracter√≠sticas m√°s importantes de un per√≠odo de 16 meses.


```{r, echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('iv_2.png')
```

üî∏ Se muestra que los factores espacio-temporales siguen siendo los m√°s influyentes en la cuadr√≠cula.

---
# Conclusiones

üî∏ Los enfoques tradicionales basados en cuadr√≠culas, muestran que un conjunto de entrenamiento de caracter√≠sticas excesivamente peque√±o da como resultado una superposici√≥n de informaci√≥n excesiva.
 
üî∏ Se pueden generar nuevas caracter√≠sticas para mejorar las predicciones,  pero un gran n√∫mero de caracter√≠sticas puede no ser lo m√°s adecuado debido a la existencia de correlaciones d√©biles.
 
üî∏ Esta es la raz√≥n por la que el DNN supera a las t√©cnicas tradicionales de aprendizaje autom√°tico y los enfoques de series de tiempo, permitiendo usar m√°s caracter√≠sticas con relaciones m√°s complejas, que permitan mejorar la discriminacion de las observaciones, sin ser afectados por las correlaciones d√©biles del exceso de variables. 

üî∏ El principal desaf√≠o del estudio, estaba concentrado en la extracci√≥n de las caracter√≠sticas de las cuadr√≠culas, punto que fue parcialmente solventado por la API de Google Place. Este punto fue clave, especialmente para incorporar el factor latente de la movilidad del delito a distintos ambientes seg√∫n patrones estacionales.

---

# Futuras investigaciones o mejoras

üî∏ El juicio experto de los agentes de polic√≠as no debe sustituirse por los avances tecnol√≥gicos y de modelado, todo lo contrario, deben complementarse y existir una retroalimentaci√≥n para usar de mejor manera las bases de datos.
 
üî∏ Se abre la posibilidad de incluir otro tipos de variables predictivas, como por ejemplo bares, y territorios de pandillas, junto con caracter√≠sticas que inhiben el crimen, como c√°maras de vigilancia y estaciones de polic√≠a. 
 
üî∏ Las variables meteorol√≥gicas como el clima y la temperatura, tambi√©n pueden considerarse.
 
üî∏ Se pueden indexar nuevas variables que describen el desplazamiento del crimen, como acciones policiales, controles y zonas de amortiguamiento para simular los efectos del desplazamiento con mayor precisi√≥n.

---

class: center, middle

# Muchas Gracias !!

## Contacto ‚úâ
Rafael Zambrano [![Twitter Badge](https://img.shields.io/badge/-@rafa_zamr-1ca0f1?style=flat&labelColor=1ca0f1&logo=twitter&logoColor=white&link=https://twitter.com/rafa_zamr)](https://twitter.com/rafa_zamr) [![Linkedin Badge](https://img.shields.io/badge/-rafael zambrano-blue?style=flat&logo=Linkedin&logoColor=white&link=https://www.linkedin.com/in/rafael-zambrano/)](https://www.linkedin.com/in/rafael-zambrano/) [![Github Badge](https://img.shields.io/badge/-rafzamb-black?style=flat&logo=Github&logoColor=white&link=https://github.com/rafzamb)](https://github.com/rafzamb) [![Website Badge](https://img.shields.io/badge/-Personal%20blog-47CCCC?style=flat&logo=Google-Chrome&logoColor=white&link=https://rafael-zambrano-blog-ds.netlify.app/)](https://rafael-zambrano-blog-ds.netlify.app/)

